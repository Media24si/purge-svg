import path from"path";import fs from"fs";import glob from"glob";var CONFIG_FILENAME="purgesvg.config.js",ERROR_CONFIG_FILE_LOADING="Error loading the config file",ERROR_OPTIONS_TYPE="Error Type Options: expected an object",ERROR_WHITELIST_TYPE="Error Type option whitelist: expected an array",ERROR_MISSING_CONTENT="No content provided.",ERROR_MISSING_SVGS="No svgs provided.",_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},createClass=function(){function t(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,r,o){return r&&t(e.prototype,r),o&&t(e,o),e}}(),toConsumableArray=function(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)},defaultOptions={content:[],svgs:[],whitelist:[]},removeDuplicates=function(t,e,r){return r.indexOf(t)===e},flatten=function(t,e){return[].concat(toConsumableArray(t),toConsumableArray(e))},PurgeSvg=function(){function t(e){classCallCheck(this,t),"string"!=typeof e&&void 0!==e||(e=t.loadConfigFile(e)),t.validateOptions(e),this.options=Object.assign(defaultOptions,e)}return createClass(t,null,[{key:"loadConfigFile",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:CONFIG_FILENAME;try{return require(path.resolve(process.cwd(),t))}catch(t){throw new Error(ERROR_CONFIG_FILE_LOADING)}}},{key:"validateOptions",value:function(t){if("object"!==(void 0===t?"undefined":_typeof(t)))throw new TypeError(ERROR_OPTIONS_TYPE);if(!t.content||!t.content.length)throw new TypeError(ERROR_MISSING_CONTENT);if(!t.svgs||!t.svgs.length)throw new TypeError(ERROR_MISSING_SVGS);if(t.whitelist&&!Array.isArray(t.whitelist))throw new TypeError(ERROR_WHITELIST_TYPE)}},{key:"globPaths",value:function(t){return"string"==typeof t&&(t=[t]),t.map(function(t){return fs.existsSync(t)?[t]:[].concat(toConsumableArray(glob.sync(t,{nodir:!0})))}).reduce(flatten,[]).filter(removeDuplicates).map(function(t){return path.resolve(process.cwd(),t)})}},{key:"extractContentIds",value:function(e){return t.globPaths(e).map(function(t){return fs.readFileSync(t,"utf-8").match(/\.svg#([A-Za-z0-9_-]+)"/g).map(function(t){return t.slice(5,-1)})}).reduce(flatten,[]).filter(removeDuplicates)}}]),t}();export default PurgeSvg;
